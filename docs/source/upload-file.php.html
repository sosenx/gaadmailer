<html>
    <head>
        <script
            type="text/javascript"
            src="../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
//echo '&lt;pre&gt;'; echo var_dump( WCM_PLUGIN_DIR ); echo '&lt;/pre&gt;';

require_once( '/home/klient.dhosting.pl/bsosnowski/wawakalendarze.dfirma.pl/public_html/wp-content/plugins/gaad-woocommerce-calendar-maker/vendor/SimpleImage/src/claviska/SimpleImage.php' );
//require_once( '/wp-content/plugins/gaad-woocommerce-calendar-maker/vendor/SimpleImage/src/claviska/SimpleImage.php' );
function cleanFiles( $dir ){
  chdir('/home/klient.dhosting.pl/bsosnowski/wawakalendarze.dfirma.pl/public_html/wp-content/');
  $files = glob(  $dir . '/*' );
  $max = count ( $files );
  for( $i = 0; $i&lt;$max; $i++){
    
    if( preg_match( '/'. $_POST['part'] .'--/', $files[$i] ) &amp;&amp; is_file( $files[$i] ) ){        
        unlink( $files[$i] );
    }
    
    
  }
  
}

if( $_FILES[0][&quot;error&quot;] == 0 ){
  
  if( $_POST['externalProject'] == 'true' ){    
    $path = '/home/klient.dhosting.pl/bsosnowski/wawakalendarze.dfirma.pl/public_html/wp-content/user_uploads/'  .  $_POST['uid'].'/' . $_POST[&quot;cartItem&quot;].'/';
    $source = is_null( $source ) ? $_FILES[ 0 ][ 'tmp_name' ] : $source;
    $file_name = $_FILES[ 0 ][ 'name' ];
    $file_path = $path . $file_name ;
    if( move_uploaded_file( $source, $file_path ) ){
      $json_file = $path .'/'. $_POST[&quot;cartItem&quot;] .'.json';
      if( is_file($json_file) ){
        $json = json_decode( file_get_contents( $json_file ), true );
        if( !is_null( $json ) ){
          $json[&quot;valid&quot;] = true;
          $json[&quot;externalproject&quot;] = true;
          $json[&quot;externalprojectpath&quot;] = $file_path;
          
          file_put_contents( $json_file, json_encode($json) );
          
        }
      }
      
      
    }
    
    
} else{
  chdir('/home/klient.dhosting.pl/bsosnowski/wawakalendarze.dfirma.pl/public_html/wp-content/');
  
  $files = array( 
    'part' =&gt; $_POST[ 'part' ],
    'cwd' =&gt; getcwd(), );
  
  $page = '';

  $tmp = 'user_uploads/'  .  $_POST['uid'].'/' . $_POST[&quot;cartItem&quot;];
  
  if( !is_dir( $tmp ) ){
    mkdir( $tmp, 0777, true );
  }
  
  
    $file_name = array();
    preg_match('/.*[\.]{1}(.*)$/', $_FILES[0][&quot;name&quot;], $file_name);
    
    
  cleanFiles( $tmp );
  
  
    $source = is_null( $source ) ? $_FILES[ 0 ][ 'tmp_name' ] : $source;		
		$attachment_id = $_POST[ 'part' ];
    $fileID = uniqid();
   // $fileID = '';
  
    if( isset( $_POST[ 'page' ] ) ){
      $page = (int)$_POST[ 'page' ] &gt; 1 ? '--'. $_POST[ 'page' ] .'--' : '';
    }  
  
		$file_name = $attachment_id . '--' . $fileID . $page . '.' . $file_name[1];
		
		//no src file, escape
		if( !is_file( $source ) ){
			$files['error'] = true;
			
			return;
		} else {
						
			try {		
				if( move_uploaded_file( $source, $target = $tmp . '/' . $file_name ) ){	
          sleep(1);
          //tworzenie miniatury pliku
            $image = new \claviska\SimpleImage();
            $image
              -&gt;fromFile($target)                     
              -&gt;resize(500,  null)-&gt;toFile( dirname( $target ) . '/th500---' . $file_name , 'image/png', 50)
              -&gt;resize(80,  null)-&gt;toFile( dirname( $target ) . '/th80---' . $file_name , 'image/png', 45);

          //echo '&lt;pre&gt;'; echo var_dump($target, $image); echo '&lt;/pre&gt;';
          
					chmod( $files['uploaded'] = $tmp . '/' . $file_name, 0777 );					
          $files['imagesize'] = getimagesize($files['uploaded']);
					$files['uploaded'] = 'https://' . $_SERVER['HTTP_HOST'] . '/wp-content/' . $files['uploaded'];
          
          $files['error'] = false;
				}
			} catch ( Exception $e) { $files['uploaded'] =  'Error: '. $e-&gt;getMessage(); }
			
		}
	
  
  
  
  
  
  
  
  
  
  
  
  echo json_encode( $files );
	die();
  
}}



?&gt;</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>